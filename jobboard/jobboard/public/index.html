<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New-Grad-Jobs API</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .jobs-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .job {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .job:last-child { border-bottom: none; }
        .job-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .job-company {
            color: #666;
            margin-bottom: 5px;
        }
        .job-category {
            display: inline-block;
            padding: 4px 8px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
        }
        .filter-controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        select, input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ New-Grad-Jobs API</h1>
        <p>Real-time job postings with intelligent categorization</p>
    </div>

    <div class="stats" id="stats">
        <div class="stat-card">
            <h3 id="total-jobs">0</h3>
            <p>Total Jobs</p>
        </div>
        <div class="stat-card">
            <h3 id="recent-jobs">0</h3>
            <p>Recent (7 days)</p>
        </div>
        <div class="stat-card">
            <h3 id="categories">0</h3>
            <p>Categories</p>
        </div>
    </div>

    <div class="filter-controls">
        <select id="category-filter">
            <option value="">All Categories</option>
        </select>
        <input type="text" id="search-input" placeholder="Search jobs...">
        <button onclick="loadJobs()">Search</button>
    </div>

    <div class="jobs-container">
        <div id="jobs-list" class="loading">
            Loading jobs...
        </div>
    </div>

    <script>
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                document.getElementById('total-jobs').textContent = stats.totalJobs;
                document.getElementById('recent-jobs').textContent = stats.recentJobs;
                document.getElementById('categories').textContent = Object.keys(stats.categories).length;
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch('/api/categories');
                const data = await response.json();
                const select = document.getElementById('category-filter');

                data.categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.category;
                    option.textContent = `${cat.displayName} (${cat.count})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }

        async function loadJobs() {
            const category = document.getElementById('category-filter').value;
            const search = document.getElementById('search-input').value;

            let url = '/api/recent?limit=20';
            if (category) url += `&category=${category}`;

            const jobsList = document.getElementById('jobs-list');
            jobsList.innerHTML = '<div class="loading">Loading jobs...</div>';

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.jobs.length === 0) {
                    jobsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No jobs found</div>';
                    return;
                }

                jobsList.innerHTML = data.jobs.map(job => `
                    <div class="job">
                        <div class="job-title">${job.title}</div>
                        <div class="job-company">${job.company}</div>
                        <div class="job-category">${job.category}</div>
                        ${job.location ? `<div style="color: #666; font-size: 14px;">üìç ${job.location}</div>` : ''}
                    </div>
                `).join('');
            } catch (error) {
                jobsList.innerHTML = '<div style="text-align: center; padding: 40px; color: red;">Failed to load jobs</div>';
                console.error('Failed to load jobs:', error);
            }
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadCategories();
            loadJobs();
        });

        // Auto-refresh every 5 minutes
        setInterval(() => {
            loadStats();
            loadJobs();
        }, 300000);
    </script>
</body>
</html>