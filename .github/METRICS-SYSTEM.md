# Job Posting Metrics System

**Created:** 2026-01-23
**Status:** Active
**Repositories:** New-Grad-Jobs-2026, Internships-2026, Remote-Jobs-2026

## Overview

The Job Posting Metrics System provides comprehensive tracking and analysis of job posting activity across all Discord channels. It aggregates data from multiple sources into a unified JSON report that's committed to git, making it easy for Claude and developers to debug and analyze posting patterns.

## Key Features

- **Job-level tracking**: Which specific jobs were posted to which channels
- **Multi-channel routing analysis**: Track jobs posted to multiple channels
- **Failure tracking**: What failed, why, and when
- **Filter analysis**: What was filtered out and for what reason
- **Historical data**: 7-day rolling window of detailed metrics
- **Always available**: Metrics committed to git for instant access

## Architecture

### Data Flow

```
┌──────────────────┐
│  Job Fetcher     │  Scrapes new jobs
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Discord Bot     │  Posts jobs to channels
└────────┬─────────┘
         │
         ├─────────────┐
         │             │
         ▼             ▼
┌──────────────────┐  ┌──────────────────┐
│ Discord Post     │  │ Routing          │
│ Logger           │  │ Logger           │
└────────┬─────────┘  └────────┬─────────┘
         │                     │
         │                     │
         ▼                     ▼
┌──────────────────────────────────────┐
│  Discord Posting Logs (JSONL)        │
│  .github/logs/discord-posts-*.jsonl  │
└────────┬─────────────────────────────┘
         │
         │  ┌────────────────────────────┐
         │  │ Routing Logs (Encrypted)   │
         │  │ .github/audit/routing-*.json│
         │  └────────┬───────────────────┘
         │           │
         │           │
         ▼           ▼
┌──────────────────────────────────────┐
│  Metrics Aggregator                  │
│  generate-metrics-report.js          │
└────────┬─────────────────────────────┘
         │
         ├──────────────┬───────────────┐
         ▼              ▼               ▼
    latest.json   YYYY-MM-DD.json   Console Output
    (committed)   (7-day retention)  (CI/CD logs)
         │
         │
         ▼
┌──────────────────────────────────────┐
│  Query Tool (for Claude/Developers)  │
│  query-metrics.js                    │
└──────────────────────────────────────┘
```

### Components

**1. Data Sources**

- **posted_jobs.json** - Master database of all posted jobs
  - Location: `.github/data/posted_jobs.json`
  - Format: JSON array with job metadata
  - Updated after each posting run

- **Discord Posting Logs** - Detailed posting results
  - Location: `.github/logs/discord-posts-YYYY-MM-DD.jsonl`
  - Format: JSONL (one JSON object per line)
  - Generated by: `discord-post-logger.js`
  - Contains: Success/failure/skip for each posting attempt

- **Routing Logs** - Channel routing decisions
  - Location: `.github/audit/routing-encrypted.json`
  - Format: Encrypted JSON
  - Generated by: `routing-logger.js`
  - Contains: Which channel each job was routed to and why

**2. Metrics Aggregator**

- **Script:** `generate-metrics-report.js`
- **Runs:** After every Discord posting run (via GitHub Actions)
- **Reads from:** All data sources listed above
- **Outputs:**
  - `latest.json` - Current metrics (committed to git)
  - `YYYY-MM-DD.json` - Daily snapshot (7-day retention)
  - Console summary for CI/CD logs

**3. Query Tool**

- **Script:** `query-metrics.js`
- **Purpose:** Easy CLI for querying metrics
- **Commands:** See "Query Commands" section below

## Metrics Report Structure

The `latest.json` file contains:

```json
{
  "generated": "2026-01-23T23:00:00Z",
  "period": "last_7_days",
  "period_start": "2026-01-16T23:00:00Z",
  "period_end": "2026-01-23T23:00:00Z",

  "summary": {
    "total_jobs_posted": 856,
    "unique_jobs": 423,
    "multi_channel_postings": 433,
    "unique_multi_channel_jobs": 215,
    "failed_postings": 12,
    "filtered_jobs": 89,
    "channels_active": 18
  },

  "by_channel": {
    "tech-jobs": {
      "channel_id": "1234567890",
      "count": 345,
      "jobs": ["job-id-1", "job-id-2", ...],
      "recent_jobs": [
        {
          "id": "job-id-1",
          "title": "Software Engineer",
          "company": "Google",
          "posted_at": "2026-01-23T20:00:00Z"
        },
        ...
      ]
    },
    ...
  },

  "multi_channel_routing": [
    {
      "job_id": "job-id-1",
      "title": "Software Engineer",
      "company": "Google",
      "channels": ["tech-jobs", "san-francisco-jobs"],
      "posted_at": "2026-01-23T20:00:00Z"
    },
    ...
  ],

  "failures": [
    {
      "job_id": "job-id-x",
      "title": "...",
      "company": "...",
      "channel": "tech-jobs",
      "error": "Rate limited",
      "error_code": "429",
      "timestamp": "2026-01-23T19:00:00Z"
    },
    ...
  ],

  "filtered": {
    "blacklisted": [...],
    "already_posted": [...],
    "invalid_data": [...],
    "other": [...]
  }
}
```

## Usage

### For Claude

**Quick Start:**

```bash
# View summary
node .github/scripts/query-metrics.js --summary

# Find specific job
node .github/scripts/query-metrics.js --job=<job-id>

# Check failures
node .github/scripts/query-metrics.js --failures

# View channel stats
node .github/scripts/query-metrics.js --channels
```

**Common Debugging Scenarios:**

1. **"Did job X get posted?"**
   ```bash
   node .github/scripts/query-metrics.js --job=jobs-smartrecruiters-com-google-12345
   ```
   Output shows which channel(s), when posted, or why it failed/was filtered.

2. **"How many jobs in tech-jobs channel?"**
   ```bash
   node .github/scripts/query-metrics.js --channel=tech-jobs
   ```
   Shows total count, unique jobs, and recent postings.

3. **"What jobs went to multiple channels?"**
   ```bash
   node .github/scripts/query-metrics.js --multi-channel
   ```
   Shows all multi-channel postings grouped by channel count.

4. **"Why aren't jobs posting?"**
   ```bash
   node .github/scripts/query-metrics.js --filtered
   ```
   Breakdown of filtered jobs by reason (blacklist, duplicates, invalid data).

5. **"What failed in the last 24 hours?"**
   ```bash
   node .github/scripts/query-metrics.js --failures --last-24h
   ```
   Recent failures with error messages.

**Direct File Access:**

```bash
# Read latest metrics
cat .github/data/metrics/latest.json

# Filter with jq
cat .github/data/metrics/latest.json | jq '.summary'
cat .github/data/metrics/latest.json | jq '.by_channel["tech-jobs"]'
cat .github/data/metrics/latest.json | jq '.failures'
```

### For Developers

**Manual Metrics Generation:**

```bash
# Generate metrics for last 7 days
node .github/scripts/generate-metrics-report.js --days=7

# Generate for last 30 days
node .github/scripts/generate-metrics-report.js --days=30
```

**Query Commands:**

```bash
# Summary view
node .github/scripts/query-metrics.js --summary

# All channels
node .github/scripts/query-metrics.js --channels

# Specific channel
node .github/scripts/query-metrics.js --channel=tech-jobs

# Multi-channel routing
node .github/scripts/query-metrics.js --multi-channel

# Failures
node .github/scripts/query-metrics.js --failures

# Filtered jobs
node .github/scripts/query-metrics.js --filtered

# Specific job
node .github/scripts/query-metrics.js --job=<job-id>

# Last 24 hours only
node .github/scripts/query-metrics.js --multi-channel --last-24h

# Raw JSON output
node .github/scripts/query-metrics.js --json

# Verbose output
node .github/scripts/query-metrics.js --channels --verbose
```

## GitHub Actions Integration

### Workflow Updates

The metrics system is integrated into the main `update-jobs.yml` workflow:

```yaml
- name: Post new jobs via Enhanced Bot
  run: node .github/scripts/enhanced-discord-bot.js
  # ... posts jobs, generates logs ...

- name: Create obfuscated audit log
  if: always()
  run: node .github/scripts/create-audit-log.js

- name: Generate metrics report
  if: always()
  run: node .github/scripts/generate-metrics-report.js --days=7
  env:
    LOG_ENCRYPT_PASSWORD: ${{ secrets.LOG_ENCRYPT_PASSWORD }}

- name: Check for changes
  # ... commits latest.json and dated snapshot ...
```

**Key Points:**

- Runs after every posting attempt (even on failure)
- Automatically commits `latest.json` to git
- Cleans up old dated snapshots (>7 days)
- Requires `LOG_ENCRYPT_PASSWORD` for routing logs

## Data Retention

| File | Retention | Committed to Git |
|------|-----------|------------------|
| `latest.json` | Forever | Yes |
| `YYYY-MM-DD.json` | 7 days | No |
| Discord posting logs | Indefinite | No (ignored) |
| Routing logs | Indefinite | Yes (encrypted) |

## Troubleshooting

### Issue: "Metrics not found"

**Cause:** Metrics haven't been generated yet.

**Solution:**
```bash
node .github/scripts/generate-metrics-report.js --days=7
```

### Issue: "Job not found in metrics"

**Possible Causes:**
- Job is older than 7 days (outside metrics window)
- Job was never posted (check `new_jobs.json`)
- Job ID is incorrect

**Solution:**
```bash
# Check if job exists in database
grep "<job-id>" .github/data/posted_jobs.json

# Generate metrics for longer period
node .github/scripts/generate-metrics-report.js --days=30
```

### Issue: "Channel data missing"

**Possible Causes:**
- Channel received no jobs in last 7 days
- Channel ID not in environment variables
- Logs are missing

**Solution:**
```bash
# Check if channel ID is configured
env | grep DISCORD_.*_CHANNEL_ID

# Check posting logs
ls -la .github/logs/discord-posts-*.jsonl
```

### Issue: "No routing logs loaded"

**Cause:** `LOG_ENCRYPT_PASSWORD` not set.

**Solution:**
```bash
export LOG_ENCRYPT_PASSWORD="your-password"
node .github/scripts/generate-metrics-report.js --days=7
```

## Advanced Usage

### Custom Date Ranges

```bash
# Last 24 hours
node .github/scripts/generate-metrics-report.js --days=1

# Last 30 days
node .github/scripts/generate-metrics-report.js --days=30

# Last 90 days
node .github/scripts/generate-metrics-report.js --days=90
```

### Comparing Snapshots

```bash
# View metrics from 3 days ago
cat .github/data/metrics/2026-01-20.json | jq '.summary'

# Compare with today
cat .github/data/metrics/latest.json | jq '.summary'

# Diff two snapshots
diff <(jq '.summary' .github/data/metrics/2026-01-20.json) \
     <(jq '.summary' .github/data/metrics/latest.json)
```

### Programmatic Access

```javascript
const { loadLatestMetrics } = require('./.github/scripts/query-metrics');

const metrics = loadLatestMetrics();

console.log(`Total jobs posted: ${metrics.summary.total_jobs_posted}`);
console.log(`Active channels: ${metrics.summary.channels_active}`);
console.log(`Success rate: ${
  (metrics.summary.total_jobs_posted /
   (metrics.summary.total_jobs_posted + metrics.summary.failed_postings) * 100
  ).toFixed(1)}%`);
```

## Security Considerations

- **Routing logs are encrypted** - Requires `LOG_ENCRYPT_PASSWORD` to decrypt
- **Metrics are not encrypted** - Contains job titles/companies (already public)
- **Discord logs are gitignored** - Not committed to repository
- **Channel IDs exposed** - Visible in metrics (considered non-sensitive)

## Multi-Repository Deployment

The metrics system is deployed to:

1. **New-Grad-Jobs-2026**
   - Channels: 9 (4 industry + 5 location)
   - Environment variable-based channel mapping

2. **Internships-2026**
   - Channels: 27 (11 industry + 15 location + 1 category)
   - Separate channel IDs with `_INT_` suffix

3. **Remote-Jobs-2026**
   - Channels: 2 (remote-jobs + remote-usa-jobs)
   - Posts to New-Grad Discord server

**Maintenance:**
- Scripts are synced across all 3 repositories
- Each repo has independent metrics
- Workflows run separately

## Performance

- **Generation time:** ~2-5 seconds for 7-day period
- **File size:** ~50-200 KB for `latest.json` (depends on activity)
- **Query time:** <1 second for all queries
- **Disk usage:** ~1-2 MB per week (dated snapshots)

## Future Enhancements

Potential improvements:

1. **Trend Analysis**
   - Track metrics over time
   - Alert on anomalies
   - Weekly/monthly reports

2. **Alerting**
   - Slack/Discord notifications for failures
   - Email alerts for critical issues
   - PagerDuty integration

3. **Performance Metrics**
   - Posting latency tracking
   - Rate limit monitoring
   - API response times

4. **Dashboard**
   - Web UI for metrics visualization
   - Real-time updates
   - Historical charts

5. **Cross-Repository Insights**
   - Unified dashboard for all 3 boards
   - Correlation analysis
   - Comparative metrics

## Support

- **Documentation:** See `README-VERIFICATION.md` for detailed usage
- **Issues:** Create GitHub issue with `metrics` label
- **Logs:** Download workflow artifacts for debugging

## Changelog

### 2026-01-23 - Initial Release

- Created metrics aggregator (`generate-metrics-report.js`)
- Created query tool (`query-metrics.js`)
- Integrated into GitHub Actions workflows
- Added comprehensive documentation
- Deployed to all 3 repositories

---

**Version:** 1.0.0
**Last Updated:** 2026-01-23
**Maintainer:** Automated via GitHub Actions
